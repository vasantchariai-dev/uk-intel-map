<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>~*~ UK Devolution & Growth Intelligence Hub ~*~</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        /* GEOCITIES VIBES */
        @import url('https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap');
        
        * {
            font-family: 'Comic Neue', 'Comic Sans MS', cursive;
        }
        
        body {
            margin: 0;
            padding: 0;
            background-color: #000080;
            background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"><rect width="20" height="20" fill="%23000080"/><rect width="10" height="10" fill="%23000066"/><rect x="10" y="10" width="10" height="10" fill="%23000066"/></svg>');
            color: #ffff00;
            min-height: 100vh;
        }
        
        .marquee-container {
            background: linear-gradient(90deg, #ff00ff, #00ffff, #ffff00, #ff00ff);
            padding: 5px;
            overflow: hidden;
        }
        
        .marquee {
            animation: marquee 15s linear infinite;
            white-space: nowrap;
            color: #000;
            font-weight: bold;
            font-size: 18px;
        }
        
        @keyframes marquee {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        
        .header {
            text-align: center;
            padding: 20px;
            background: linear-gradient(180deg, #800080 0%, #000080 100%);
            border-bottom: 5px ridge #c0c0c0;
        }
        
        .header h1 {
            color: #00ff00;
            text-shadow: 3px 3px #ff00ff, -1px -1px #000;
            font-size: 2.5em;
            margin: 10px 0;
            animation: rainbow 3s infinite;
        }
        
        @keyframes rainbow {
            0% { color: #ff0000; }
            17% { color: #ff8800; }
            33% { color: #ffff00; }
            50% { color: #00ff00; }
            67% { color: #00ffff; }
            83% { color: #ff00ff; }
            100% { color: #ff0000; }
        }
        
        .under-construction {
            display: inline-block;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .main-container {
            display: flex;
            flex-wrap: wrap;
            padding: 10px;
            gap: 10px;
        }
        
        .sidebar {
            width: 280px;
            background: #c0c0c0;
            border: 3px outset #fff;
            padding: 10px;
            color: #000;
        }
        
        .sidebar h2 {
            background: linear-gradient(90deg, #000080, #0000ff);
            color: #fff;
            padding: 5px;
            margin: -10px -10px 10px -10px;
            font-size: 14px;
        }
        
        .map-container {
            flex: 1;
            min-width: 500px;
            height: 600px;
            border: 5px ridge #808080;
        }
        
        #map {
            width: 100%;
            height: 100%;
        }
        
        .layer-toggle {
            margin: 5px 0;
            padding: 5px;
            background: #fff;
            border: 2px inset #808080;
        }
        
        .layer-toggle label {
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .layer-toggle input[type="checkbox"] {
            width: 16px;
            height: 16px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 5px 0;
            font-size: 12px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border: 1px solid #000;
        }
        
        .btn-90s {
            background: linear-gradient(180deg, #dfdfdf 0%, #c0c0c0 50%, #a0a0a0 100%);
            border: 3px outset #fff;
            padding: 8px 15px;
            cursor: pointer;
            font-family: 'Comic Neue', cursive;
            font-weight: bold;
            margin: 5px 0;
            width: 100%;
        }
        
        .btn-90s:active {
            border-style: inset;
        }
        
        .btn-90s:hover {
            background: linear-gradient(180deg, #efefef 0%, #d0d0d0 50%, #b0b0b0 100%);
        }
        
        .form-section {
            background: #fff;
            border: 2px inset #808080;
            padding: 10px;
            margin-top: 10px;
        }
        
        .form-section h3 {
            margin: 0 0 10px 0;
            color: #800080;
            font-size: 14px;
            border-bottom: 1px dashed #800080;
        }
        
        .form-group {
            margin: 8px 0;
        }
        
        .form-group label {
            display: block;
            font-size: 12px;
            font-weight: bold;
            color: #000080;
        }
        
        .form-group select,
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 5px;
            border: 2px inset #808080;
            font-family: 'Comic Neue', cursive;
            box-sizing: border-box;
        }
        
        .form-group textarea {
            height: 60px;
            resize: vertical;
        }
        
        .visitor-counter {
            background: #000;
            color: #00ff00;
            padding: 10px;
            text-align: center;
            margin-top: 10px;
            border: 2px inset #808080;
            font-family: 'Courier New', monospace;
        }
        
        .guestbook-link {
            text-align: center;
            margin-top: 10px;
        }
        
        .guestbook-link a {
            color: #ff00ff;
            text-decoration: underline;
        }
        
        .webring {
            background: #ffff00;
            color: #000;
            padding: 10px;
            margin-top: 10px;
            border: 2px ridge #808080;
            text-align: center;
            font-size: 11px;
        }
        
        .footer {
            background: #000;
            color: #00ff00;
            text-align: center;
            padding: 10px;
            font-size: 12px;
            border-top: 3px ridge #c0c0c0;
        }
        
        .footer a {
            color: #00ffff;
        }
        
        .sparkle {
            animation: sparkle 0.5s infinite alternate;
        }
        
        @keyframes sparkle {
            from { opacity: 0.5; }
            to { opacity: 1; }
        }
        
        /* Leaflet popup styling */
        .leaflet-popup-content-wrapper {
            background: #c0c0c0;
            border: 3px outset #fff;
            border-radius: 0;
        }
        
        .leaflet-popup-content {
            font-family: 'Comic Neue', cursive;
            color: #000;
        }
        
        .leaflet-popup-tip {
            background: #c0c0c0;
        }
        
        .popup-title {
            font-weight: bold;
            color: #000080;
            border-bottom: 1px solid #808080;
            padding-bottom: 5px;
            margin-bottom: 5px;
        }
        
        .popup-category {
            display: inline-block;
            padding: 2px 6px;
            font-size: 11px;
            font-weight: bold;
            margin: 2px 0;
        }
        
        .popup-category.devolution { background: #ff6b6b; color: #fff; }
        .popup-category.local-growth { background: #4ecdc4; color: #000; }
        .popup-category.transport { background: #45b7d1; color: #000; }
        .popup-category.construction { background: #96c93d; color: #000; }
        
        .intel-list {
            max-height: 150px;
            overflow-y: auto;
            font-size: 12px;
        }
        
        .intel-item {
            padding: 5px;
            margin: 3px 0;
            background: #fff;
            border: 1px solid #808080;
        }
        
        .catapult-icon {
            background: #ff6600;
            border: 2px solid #000;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #fff;
            font-size: 12px;
        }
        
        .status-message {
            padding: 5px;
            margin: 5px 0;
            font-size: 12px;
            text-align: center;
        }
        
        .status-success {
            background: #90EE90;
            color: #006400;
        }
        
        .status-error {
            background: #FFB6C1;
            color: #8B0000;
        }
        
        .click-instruction {
            background: #ffffcc;
            padding: 5px;
            font-size: 11px;
            text-align: center;
            border: 1px dashed #808080;
            margin: 5px 0;
            display: none;
        }
        
        .click-instruction.active {
            display: block;
        }
        
        @media (max-width: 800px) {
            .main-container {
                flex-direction: column;
            }
            .sidebar {
                width: auto;
            }
            .map-container {
                min-width: auto;
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="marquee-container">
        <div class="marquee">
            ‚òÖÂΩ° WELCOME TO THE UK DEVOLUTION & LOCAL GROWTH INTELLIGENCE HUB ÂΩ°‚òÖ --- ADD YOUR INTEL! --- TRACK TRANSPORT, CONSTRUCTION, DEVOLUTION & LOCAL GROWTH --- POWERED BY PEOPLE LIKE YOU! ---
        </div>
    </div>
    
    <div class="header">
        <span class="under-construction">üöß</span>
        <h1>~*~ UK Devolution Map ~*~</h1>
        <p style="color: #00ffff; margin: 5px;">‚ú® Combined Authorities ‚Ä¢ Catapult Centres ‚Ä¢ Crowd-sourced Intelligence ‚ú®</p>
        <span class="under-construction">üöß</span>
    </div>
    
    <div class="main-container">
        <div class="sidebar">
            <h2>üìÅ LAYER CONTROLS</h2>
            
            <div class="layer-toggle">
                <label>
                    <input type="checkbox" id="toggleAuthorities" checked>
                    üó∫Ô∏è Combined/Mayoral Authorities
                </label>
            </div>
            
            <div class="layer-toggle">
                <label>
                    <input type="checkbox" id="toggleCatapults" checked>
                    üöÄ Catapult Centres
                </label>
            </div>
            
            <div class="layer-toggle">
                <label>
                    <input type="checkbox" id="toggleIntelligence" checked>
                    üí° User Intelligence
                </label>
            </div>

            <div class="layer-toggle">
                <label>
                    <input type="checkbox" id="toggleFreeports" checked>
                    üö¢ Freeports
                </label>
            </div>

            <div class="layer-toggle">
                <label>
                    <input type="checkbox" id="toggleInvestmentZones" checked>
                    üí∞ Investment Zones
                </label>
            </div>

            <div class="layer-toggle">
                <label>
                    <input type="checkbox" id="togglePreloadedIntel" checked>
                    üì° Official Intelligence
                </label>
            </div>

            <hr style="border: 1px inset #808080;">
            
            <h2>üìä LEGEND</h2>
            <div class="legend-item">
                <div class="legend-color" style="background: rgba(100, 149, 237, 0.4); border: 2px solid #4169e1;"></div>
                <span>Combined Authority</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #ff6600; border-radius: 50%;"></div>
                <span>Catapult Centre</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #00CED1; border: 2px solid #008B8B;"></div>
                <span>Freeport</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #FFD700; border: 2px solid #DAA520;"></div>
                <span>Investment Zone</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #9932CC; border-radius: 50%;"></div>
                <span>Official Intel</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #ff6b6b;"></div>
                <span>Devolution Intel</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #4ecdc4;"></div>
                <span>Local Growth Intel</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #45b7d1;"></div>
                <span>Transport Intel</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #96c93d;"></div>
                <span>Construction Intel</span>
            </div>
            
            <div class="form-section">
                <h3>üìù ADD INTELLIGENCE</h3>
                
                <div id="clickInstruction" class="click-instruction">
                    üëÜ Click on the map to set location!
                </div>
                
                <div class="form-group">
                    <label>Category:</label>
                    <select id="intelCategory">
                        <option value="devolution">Devolution</option>
                        <option value="local-growth">Local Growth</option>
                        <option value="transport">Transport</option>
                        <option value="construction">Construction</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Location:</label>
                    <button class="btn-90s" id="pickLocationBtn">üìç Pick on Map</button>
                    <input type="text" id="locationDisplay" placeholder="Click map or enter coords" readonly style="margin-top: 5px;">
                    <input type="hidden" id="intelLat">
                    <input type="hidden" id="intelLng">
                </div>
                
                <div class="form-group">
                    <label>Your Intelligence:</label>
                    <textarea id="intelText" placeholder="What's happening here?"></textarea>
                </div>
                
                <button class="btn-90s" id="submitIntel">‚ú® Submit Intel ‚ú®</button>
                
                <div id="statusMessage"></div>
            </div>
            
            <button class="btn-90s" id="clearAllIntel" style="background: #ffcccc;">üóëÔ∏è Clear All My Intel</button>
            
            <div class="visitor-counter">
                <div>YOU ARE VISITOR</div>
                <div style="font-size: 24px; letter-spacing: 2px;" id="visitorCount">000042</div>
            </div>
            
            <div class="guestbook-link">
                <a href="#" onclick="alert('Guestbook coming soon! üìñ'); return false;">üìñ Sign my Guestbook!</a>
            </div>
            
            <div class="webring">
                <strong>üîó UK Gov WebRing üîó</strong><br>
                <a href="#">&lt;&lt; Prev</a> |
                <a href="#">Random</a> |
                <a href="#">Next &gt;&gt;</a>
            </div>
        </div>
        
        <div class="map-container">
            <div id="map"></div>
        </div>
    </div>
    
    <div class="footer">
        <p>
            <span class="sparkle">‚òÖ</span>
            Best viewed in Netscape Navigator 4.0 at 800x600 
            <span class="sparkle">‚òÖ</span>
        </p>
        <p>
            Made with üíú in 2025 | 
            <a href="mailto:webmaster@example.com">Email the Webmaster</a> |
            <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="counter" style="width: 1px;">
        </p>
        <p style="font-size: 10px;">
            Data sources: ONS, Catapult Network, Institute for Government | No copyright intended
        </p>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Initialize map centred on England
        const map = L.map('map').setView([53.0, -1.5], 6);
        
        // Add tile layer - using a vintage-ish style
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors',
            maxZoom: 18
        }).addTo(map);
        
        // Layer groups
        const authoritiesLayer = L.layerGroup().addTo(map);
        const catapultsLayer = L.layerGroup().addTo(map);
        const intelligenceLayer = L.layerGroup().addTo(map);
        const freeportsLayer = L.layerGroup().addTo(map);
        const investmentZonesLayer = L.layerGroup().addTo(map);
        const preloadedIntelLayer = L.layerGroup().addTo(map);
        
        // Combined/Mayoral Authorities data with approximate boundaries
        const combinedAuthorities = [
            {
                name: "Greater Manchester",
                mayor: "Andy Burnham",
                center: [53.4808, -2.2426],
                bounds: [[53.35, -2.55], [53.35, -1.95], [53.62, -1.95], [53.62, -2.55]]
            },
            {
                name: "Liverpool City Region",
                mayor: "Steve Rotheram",
                center: [53.4084, -2.9916],
                bounds: [[53.25, -3.15], [53.25, -2.70], [53.55, -2.70], [53.55, -3.15]]
            },
            {
                name: "West Midlands",
                mayor: "Richard Parker",
                center: [52.4862, -1.8904],
                bounds: [[52.30, -2.15], [52.30, -1.55], [52.65, -1.55], [52.65, -2.15]]
            },
            {
                name: "West Yorkshire",
                mayor: "Tracy Brabin",
                center: [53.8008, -1.5491],
                bounds: [[53.60, -2.00], [53.60, -1.20], [53.95, -1.20], [53.95, -2.00]]
            },
            {
                name: "South Yorkshire",
                mayor: "Oliver Coppard",
                center: [53.3811, -1.4701],
                bounds: [[53.20, -1.80], [53.20, -1.05], [53.55, -1.05], [53.55, -1.80]]
            },
            {
                name: "Tees Valley",
                mayor: "Ben Houchen",
                center: [54.5704, -1.2350],
                bounds: [[54.40, -1.55], [54.40, -0.95], [54.72, -0.95], [54.72, -1.55]]
            },
            {
                name: "North East",
                mayor: "Kim McGuinness",
                center: [54.9783, -1.6178],
                bounds: [[54.75, -2.00], [54.75, -1.25], [55.20, -1.25], [55.20, -2.00]]
            },
            {
                name: "Cambridgeshire & Peterborough",
                mayor: "Nik Johnson",
                center: [52.4053, 0.0648],
                bounds: [[52.10, -0.40], [52.10, 0.50], [52.70, 0.50], [52.70, -0.40]]
            },
            {
                name: "West of England",
                mayor: "Dan Norris",
                center: [51.4545, -2.5879],
                bounds: [[51.30, -2.80], [51.30, -2.35], [51.60, -2.35], [51.60, -2.80]]
            },
            {
                name: "Greater London",
                mayor: "Sadiq Khan",
                center: [51.5074, -0.1278],
                bounds: [[51.30, -0.50], [51.30, 0.30], [51.70, 0.30], [51.70, -0.50]]
            },
            {
                name: "York & North Yorkshire",
                mayor: "David Skaith",
                center: [54.0000, -1.2000],
                bounds: [[53.75, -1.80], [53.75, -0.60], [54.40, -0.60], [54.40, -1.80]]
            },
            {
                name: "East Midlands",
                mayor: "Claire Ward",
                center: [52.9548, -1.1581],
                bounds: [[52.70, -1.50], [52.70, -0.80], [53.20, -0.80], [53.20, -1.50]]
            },
            {
                name: "Hull & East Yorkshire",
                mayor: "TBC (elections 2025)",
                center: [53.7676, -0.3274],
                bounds: [[53.55, -0.70], [53.55, 0.10], [53.95, 0.10], [53.95, -0.70]]
            },
            {
                name: "Greater Lincolnshire",
                mayor: "TBC (deal agreed)",
                center: [53.2000, -0.2000],
                bounds: [[52.70, -0.60], [52.70, 0.30], [53.50, 0.30], [53.50, -0.60]]
            }
        ];
        
        // Draw combined authorities
        combinedAuthorities.forEach(auth => {
            const polygon = L.polygon(auth.bounds, {
                color: '#4169e1',
                fillColor: '#6495ed',
                fillOpacity: 0.3,
                weight: 3
            }).addTo(authoritiesLayer);
            
            polygon.bindPopup(`
                <div class="popup-title">üèõÔ∏è ${auth.name}</div>
                <p><strong>Mayor:</strong> ${auth.mayor}</p>
                <p><em>Click to see intelligence in this area</em></p>
            `);
        });
        
        // Catapult Centres data
        const catapultCentres = [
            // Cell and Gene Therapy
            { name: "Cell & Gene Therapy Catapult", location: "London (Guy's Hospital)", lat: 51.5025, lng: -0.0887, type: "Cell & Gene Therapy" },
            { name: "Cell & Gene Therapy Catapult", location: "Stevenage", lat: 51.9032, lng: -0.2019, type: "Cell & Gene Therapy" },
            { name: "Cell & Gene Therapy Catapult", location: "Braintree", lat: 51.8787, lng: 0.5500, type: "Cell & Gene Therapy" },
            { name: "Cell & Gene Therapy Catapult", location: "Edinburgh", lat: 55.9221, lng: -3.1747, type: "Cell & Gene Therapy" },
            
            // Compound Semiconductor
            { name: "Compound Semiconductor Applications Catapult", location: "Newport", lat: 51.5842, lng: -2.9977, type: "Compound Semiconductor" },
            { name: "Compound Semiconductor Applications Catapult", location: "Bristol", lat: 51.4545, lng: -2.5879, type: "Compound Semiconductor" },
            
            // Connected Places
            { name: "Connected Places Catapult", location: "London", lat: 51.5322, lng: -0.1234, type: "Connected Places" },
            { name: "Connected Places Catapult", location: "Belfast", lat: 54.5973, lng: -5.9301, type: "Connected Places" },
            { name: "Connected Places Catapult", location: "Bristol", lat: 51.4600, lng: -2.5800, type: "Connected Places" },
            
            // Digital Catapult
            { name: "Digital Catapult", location: "London (King's Cross)", lat: 51.5340, lng: -0.1250, type: "Digital" },
            { name: "Digital Catapult", location: "Belfast", lat: 54.6000, lng: -5.9200, type: "Digital" },
            { name: "Digital Catapult", location: "North East", lat: 54.9700, lng: -1.6100, type: "Digital" },
            
            // High Value Manufacturing - AMRC
            { name: "AMRC (HVM Catapult)", location: "Sheffield/Rotherham", lat: 53.4000, lng: -1.3500, type: "HVM" },
            
            // High Value Manufacturing - MTC
            { name: "MTC (HVM Catapult)", location: "Coventry", lat: 52.4100, lng: -1.5100, type: "HVM" },
            { name: "MTC (HVM Catapult)", location: "Liverpool", lat: 53.4050, lng: -2.9700, type: "HVM" },
            { name: "MTC (HVM Catapult)", location: "Oxford/Culham", lat: 51.6600, lng: -1.2300, type: "HVM" },
            
            // High Value Manufacturing - NCC
            { name: "NCC (HVM Catapult)", location: "Bristol", lat: 51.5200, lng: -2.5500, type: "HVM" },
            
            // High Value Manufacturing - CPI
            { name: "CPI (HVM Catapult)", location: "Sedgefield", lat: 54.6500, lng: -1.4500, type: "HVM" },
            { name: "CPI (HVM Catapult)", location: "Liverpool", lat: 53.4000, lng: -2.9800, type: "HVM" },
            
            // High Value Manufacturing - WMG
            { name: "WMG (HVM Catapult)", location: "Warwick/Coventry", lat: 52.3800, lng: -1.5600, type: "HVM" },
            
            // High Value Manufacturing - NMIS/AFRC
            { name: "NMIS/AFRC (HVM Catapult)", location: "Glasgow/Paisley", lat: 55.8450, lng: -4.4200, type: "HVM" },
            
            // Medicines Discovery
            { name: "Medicines Discovery Catapult", location: "Alderley Park, Cheshire", lat: 53.2700, lng: -2.2300, type: "Medicines Discovery" },
            
            // Offshore Renewable Energy
            { name: "ORE Catapult", location: "Glasgow", lat: 55.8600, lng: -4.2500, type: "Offshore Renewable Energy" },
            { name: "ORE Catapult", location: "Blyth", lat: 55.1260, lng: -1.5080, type: "Offshore Renewable Energy" },
            { name: "ORE Catapult", location: "Levenmouth", lat: 56.1950, lng: -3.0000, type: "Offshore Renewable Energy" },
            { name: "ORE Catapult", location: "Grimsby", lat: 53.5675, lng: -0.0800, type: "Offshore Renewable Energy" },
            { name: "ORE Catapult", location: "Pembroke Dock", lat: 51.6900, lng: -4.9400, type: "Offshore Renewable Energy" },
            
            // Satellite Applications
            { name: "Satellite Applications Catapult", location: "Harwell, Oxfordshire", lat: 51.5700, lng: -1.3100, type: "Satellite Applications" },
            { name: "Satellite Applications Catapult", location: "Leicester", lat: 52.6369, lng: -1.1398, type: "Satellite Applications" },
            { name: "Satellite Applications Catapult", location: "Cornwall", lat: 50.4400, lng: -5.0500, type: "Satellite Applications" }
        ];

        // UK Freeports data
        const freeports = [
            { name: "East Midlands Freeport", location: "East Midlands Airport & Gateway", lat: 52.8311, lng: -1.3278, status: "Operational", taxSites: 3, customsSites: 2, focus: "Advanced manufacturing, logistics" },
            { name: "Felixstowe & Harwich Freeport", location: "Suffolk/Essex", lat: 51.9536, lng: 1.3117, status: "Operational", taxSites: 3, customsSites: 3, focus: "Ports, logistics, green energy" },
            { name: "Humber Freeport", location: "Hull & Grimsby", lat: 53.7350, lng: -0.3000, status: "Operational", taxSites: 4, customsSites: 2, focus: "Offshore wind, decarbonisation" },
            { name: "Liverpool City Region Freeport", location: "Merseyside", lat: 53.4500, lng: -2.9500, status: "Operational", taxSites: 3, customsSites: 2, focus: "Life sciences, advanced manufacturing" },
            { name: "Plymouth and South Devon Freeport", location: "Devon", lat: 50.3755, lng: -4.1427, status: "Operational", taxSites: 3, customsSites: 2, focus: "Marine, defence, space" },
            { name: "Solent Freeport", location: "Southampton & Portsmouth", lat: 50.8975, lng: -1.3960, status: "Operational", taxSites: 3, customsSites: 2, focus: "Maritime, advanced manufacturing" },
            { name: "Teesside Freeport", location: "Teesside", lat: 54.6080, lng: -1.0700, status: "Operational", taxSites: 4, customsSites: 2, focus: "Clean energy, advanced manufacturing" },
            { name: "Thames Freeport", location: "Essex (Tilbury, London Gateway)", lat: 51.4600, lng: 0.3600, status: "Operational", taxSites: 3, customsSites: 3, focus: "Logistics, advanced manufacturing" },
            // Scotland Green Freeports
            { name: "Inverness & Cromarty Firth Green Freeport", location: "Scottish Highlands", lat: 57.5000, lng: -4.2000, status: "Operational", taxSites: 3, customsSites: 2, focus: "Floating offshore wind, hydrogen" },
            { name: "Forth Green Freeport", location: "Edinburgh/Fife", lat: 56.0200, lng: -3.4000, status: "Operational", taxSites: 4, customsSites: 2, focus: "Renewables, chemicals, shipbuilding" },
            // Wales Freeports
            { name: "Celtic Freeport", location: "Port Talbot & Milford Haven", lat: 51.6000, lng: -3.8000, status: "Designated", taxSites: 3, customsSites: 2, focus: "Floating offshore wind, green steel" }
        ];

        // Investment Zones data
        const investmentZones = [
            // England Investment Zones
            { name: "Liverpool City Region Investment Zone", region: "Liverpool", lat: 53.4084, lng: -2.9916, focus: "Health & life sciences, advanced manufacturing", funding: "80m" },
            { name: "Greater Manchester Investment Zone", region: "Greater Manchester", lat: 53.4808, lng: -2.2426, focus: "Advanced materials, manufacturing, digital", funding: "80m" },
            { name: "North East Investment Zone", region: "North East", lat: 54.9783, lng: -1.6178, focus: "Electric vehicles, battery technology", funding: "80m" },
            { name: "South Yorkshire Investment Zone", region: "South Yorkshire", lat: 53.3811, lng: -1.4701, focus: "Advanced manufacturing, green industries", funding: "80m" },
            { name: "Tees Valley Investment Zone", region: "Tees Valley", lat: 54.5704, lng: -1.2350, focus: "Clean energy, process industries", funding: "80m" },
            { name: "West Midlands Investment Zone", region: "West Midlands", lat: 52.4862, lng: -1.8904, focus: "Automotive, battery technology, healthcare", funding: "80m" },
            { name: "West Yorkshire Investment Zone", region: "West Yorkshire", lat: 53.8008, lng: -1.5491, focus: "Life sciences, digital, green industries", funding: "80m" },
            { name: "East Midlands Investment Zone", region: "East Midlands", lat: 52.9548, lng: -1.1581, focus: "Advanced manufacturing, space, energy", funding: "80m" },
            // Extended Investment Zones (2024)
            { name: "West of England Investment Zone", region: "Bristol/Bath", lat: 51.4545, lng: -2.5879, focus: "Advanced engineering, creative digital", funding: "80m" },
            { name: "Cambridge Investment Zone", region: "Cambridgeshire", lat: 52.2053, lng: 0.1218, focus: "Life sciences, digital", funding: "80m" },
            { name: "Greater London Investment Zone", region: "London", lat: 51.5074, lng: -0.1278, focus: "Life sciences, green industries", funding: "80m" },
            { name: "Hull & East Riding Investment Zone", region: "Hull", lat: 53.7676, lng: -0.3274, focus: "Renewable energy, digital", funding: "80m" },
            // Scotland Investment Zones
            { name: "Glasgow City Region Investment Zone", region: "Glasgow", lat: 55.8642, lng: -4.2518, focus: "Advanced manufacturing, net zero", funding: "80m" },
            { name: "North East Scotland Investment Zone", region: "Aberdeen", lat: 57.1497, lng: -2.0943, focus: "Energy transition", funding: "80m" },
            // Wales Investment Zones
            { name: "Wrexham & Flintshire Investment Zone", region: "North Wales", lat: 53.0460, lng: -2.9930, focus: "Advanced manufacturing", funding: "80m" },
            { name: "South East Wales Investment Zone", region: "Cardiff/Newport", lat: 51.4816, lng: -3.1791, focus: "Compound semiconductors, fintech", funding: "80m" }
        ];

        // Pre-loaded official intelligence (major projects and initiatives)
        const preloadedIntelligence = [
            // DEVOLUTION INTELLIGENCE
            { lat: 53.4808, lng: -2.2426, category: "devolution", title: "Trailblazer Devolution Deal", text: "Greater Manchester secured historic single funding settlement and new powers over housing, transport and skills in 2023.", source: "DLUHC" },
            { lat: 52.4862, lng: -1.8904, category: "devolution", title: "Trailblazer Devolution Deal", text: "West Midlands agreed 'trailblazer' deal with powers over transport, skills, housing and business support.", source: "DLUHC" },
            { lat: 54.9783, lng: -1.6178, category: "devolution", title: "North East Mayoral Combined Authority", text: "New combined authority launched in 2024 covering 7 councils. First mayor Kim McGuinness elected.", source: "MHCLG" },
            { lat: 53.8008, lng: -1.5491, category: "devolution", title: "West Yorkshire Devolution", text: "West Yorkshire CA gaining enhanced powers including adult education budget and brownfield housing fund.", source: "WYCA" },
            { lat: 51.4545, lng: -2.5879, category: "devolution", title: "West of England Level 4 Deal", text: "Mayor Dan Norris pursuing enhanced devolution settlement with new powers over transport and skills.", source: "WECA" },
            { lat: 53.2000, lng: -0.2000, category: "devolution", title: "Greater Lincolnshire Deal", text: "New devolution deal agreed covering North Lincolnshire, North East Lincolnshire and Lincolnshire County.", source: "DLUHC" },
            { lat: 53.7676, lng: -0.3274, category: "devolution", title: "Hull & East Yorkshire Deal", text: "New mayoral combined authority established covering Hull and East Riding. Elections held May 2025.", source: "DLUHC" },
            { lat: 50.7184, lng: -1.8800, category: "devolution", title: "Bournemouth Christchurch Poole Deal", text: "Level 2 devolution deal agreed for BCP and Dorset Council with new combined authority.", source: "DLUHC" },
            { lat: 51.2658, lng: 1.0880, category: "devolution", title: "Kent & Medway Deal", text: "Level 2 devolution deal in discussion for greater local powers.", source: "DLUHC" },
            { lat: 52.6309, lng: 1.2974, category: "devolution", title: "Norfolk & Suffolk Deal", text: "Level 2 devolution deal agreed for Norfolk and Suffolk councils.", source: "DLUHC" },
            { lat: 50.3755, lng: -4.1427, category: "devolution", title: "Devon & Torbay Deal", text: "Level 2 devolution discussions ongoing for combined county deal.", source: "DLUHC" },
            { lat: 53.0027, lng: -2.1794, category: "devolution", title: "Staffordshire & Stoke Deal", text: "Level 2 devolution deal in negotiation.", source: "DLUHC" },

            // TRANSPORT INTELLIGENCE
            { lat: 52.4774, lng: -1.8991, category: "transport", title: "HS2 Phase 1 Construction", text: "HS2 construction ongoing between London and Birmingham. Main works progressing at Old Oak Common.", source: "HS2 Ltd" },
            { lat: 51.5200, lng: -0.4400, category: "transport", title: "HS2 Old Oak Common Station", text: "Major interchange being built connecting HS2 with Elizabeth line and Great Western services.", source: "HS2 Ltd" },
            { lat: 52.4816, lng: -1.8975, category: "transport", title: "HS2 Birmingham Curzon Street", text: "New terminus station under construction in Birmingham city centre.", source: "HS2 Ltd" },
            { lat: 53.4808, lng: -2.2426, category: "transport", title: "Northern Powerhouse Rail Study", text: "Studies continue for improved rail links between Manchester and Leeds following HS2 northern leg cancellation.", source: "DfT" },
            { lat: 53.4084, lng: -2.9916, category: "transport", title: "Liverpool-Manchester Rail Upgrade", text: "Significant capacity improvements planned for TransPennine route.", source: "Network Rail" },
            { lat: 51.5074, lng: -0.1278, category: "transport", title: "Elizabeth Line Success", text: "Crossrail fully operational, boosting connectivity across London and commuter belt.", source: "TfL" },
            { lat: 53.9600, lng: -1.0873, category: "transport", title: "Transpennine Route Upgrade", text: "Major upgrade to rail capacity and electrification between York and Manchester.", source: "Network Rail" },
            { lat: 51.8821, lng: -0.4050, category: "transport", title: "Luton DART", text: "New direct air-rail transit system operational from Luton Airport Parkway.", source: "Luton Rising" },
            { lat: 51.4700, lng: -0.4543, category: "transport", title: "Heathrow Western Rail Link", text: "Proposed new rail connection from Reading to Heathrow Terminal 5.", source: "DfT" },
            { lat: 54.5704, lng: -1.2350, category: "transport", title: "Tees Valley Bus Reform", text: "Tees Valley pursuing bus franchising powers to improve public transport.", source: "TVCA" },
            { lat: 53.4808, lng: -2.2426, category: "transport", title: "Bee Network Expansion", text: "Greater Manchester bus franchising now fully operational - first outside London since deregulation.", source: "TfGM" },
            { lat: 51.5074, lng: -0.1278, category: "transport", title: "Silvertown Tunnel", text: "New road tunnel under Thames nearing completion, will connect Greenwich Peninsula and Silvertown.", source: "TfL" },
            { lat: 55.8642, lng: -4.2518, category: "transport", title: "Glasgow Metro Proposal", text: "Plans for new metro system for Glasgow city region under development.", source: "Transport Scotland" },
            { lat: 53.3811, lng: -1.4701, category: "transport", title: "South Yorkshire Mass Transit", text: "Plans for new mass transit system connecting Sheffield, Rotherham, Barnsley and Doncaster.", source: "SYMCA" },
            { lat: 52.4862, lng: -1.8904, category: "transport", title: "West Midlands Metro Extension", text: "Metro extensions to Wolverhampton station and Brierley Hill under construction.", source: "WMCA" },
            { lat: 53.7500, lng: -0.3500, category: "transport", title: "Humber Bridge Tolls Removed", text: "Humber Bridge tolls significantly reduced to boost connectivity.", source: "Humber Bridge Board" },

            // LOCAL GROWTH INTELLIGENCE
            { lat: 54.6080, lng: -1.0700, category: "local-growth", title: "Teesworks Development", text: "Largest industrial development site in UK. Major investment in clean energy and manufacturing.", source: "TVCA" },
            { lat: 53.7456, lng: -0.3367, category: "local-growth", title: "Siemens Gamesa Blade Factory", text: "Major offshore wind blade manufacturing facility operational in Hull.", source: "Siemens Gamesa" },
            { lat: 54.6000, lng: -1.0500, category: "local-growth", title: "SeAH Wind Investment", text: "Korean company building monopile manufacturing facility at Teesside - 750+ jobs.", source: "SeAH Wind" },
            { lat: 51.5074, lng: -0.1278, category: "local-growth", title: "London Tech Cluster", text: "UK's largest technology cluster continues to grow around Old Street and Kings Cross.", source: "Tech Nation" },
            { lat: 52.2053, lng: 0.1218, category: "local-growth", title: "Cambridge Life Sciences", text: "Cambridge biotech cluster - one of largest in Europe with major growth in genomics and AI.", source: "Cambridge Ahead" },
            { lat: 51.7520, lng: -1.2577, category: "local-growth", title: "Oxford Science Arc", text: "Arc of innovation from Harwell to central Oxford with major life sciences investment.", source: "OxLEP" },
            { lat: 53.4808, lng: -2.2426, category: "local-growth", title: "MediaCity Expansion", text: "MediaCity UK at Salford Quays continues expansion with new tech and creative businesses.", source: "MediaCity" },
            { lat: 51.4545, lng: -2.5879, category: "local-growth", title: "Bristol Temple Quarter", text: "Major regeneration around Temple Meads station including new university campus.", source: "Bristol City Council" },
            { lat: 52.4862, lng: -1.8904, category: "local-growth", title: "UK Battery Industrialisation Centre", text: "National facility at Coventry supporting battery manufacturing scale-up.", source: "UKBIC" },
            { lat: 55.0000, lng: -1.6000, category: "local-growth", title: "Blyth Energy Hub", text: "Major cluster for offshore renewable energy including ORE Catapult facilities.", source: "ORE Catapult" },
            { lat: 53.9500, lng: -1.0800, category: "local-growth", title: "York Biotech Campus", text: "Growing biotechnology campus around University of York.", source: "UoY" },
            { lat: 50.3755, lng: -4.1427, category: "local-growth", title: "Plymouth Marine Innovation", text: "National Marine Park and marine innovation hub development.", source: "PCC" },
            { lat: 51.5000, lng: 0.1000, category: "local-growth", title: "Royal Docks Enterprise Zone", text: "Major regeneration with focus on food innovation and data centres.", source: "GLA" },
            { lat: 53.2300, lng: -2.2500, category: "local-growth", title: "Alderley Park Growth", text: "Life sciences campus with over 200 companies and major pharma presence.", source: "Bruntwood SciTech" },
            { lat: 52.9700, lng: -1.1700, category: "local-growth", title: "Nottingham Creative Quarter", text: "Creative industries hub in city centre with gaming and digital media focus.", source: "Creative Quarter Company" },
            { lat: 50.8200, lng: -0.1400, category: "local-growth", title: "Brighton Digital Hub", text: "One of UK's fastest growing digital clusters outside London.", source: "Wired Sussex" },
            { lat: 54.9700, lng: -1.6100, category: "local-growth", title: "Newcastle Helix", text: "24-acre urban development for science and technology in Newcastle city centre.", source: "Newcastle City Council" },
            { lat: 53.4000, lng: -1.4700, category: "local-growth", title: "AMID (Advanced Manufacturing Innovation District)", text: "Sheffield cluster linking university research with manufacturing industry.", source: "AMID" },
            { lat: 56.4620, lng: -2.9700, category: "local-growth", title: "Dundee Waterfront", text: "Major regeneration including V&A Dundee driving cultural and economic growth.", source: "Dundee City Council" },
            { lat: 51.4500, lng: -2.6000, category: "local-growth", title: "Bristol & Bath Creative Cluster", text: "One of UK's leading creative clusters including Aardman, Massive Attack.", source: "Bristol Creative Industries" },

            // CONSTRUCTION INTELLIGENCE
            { lat: 51.5045, lng: -0.0865, category: "construction", title: "The Shard Quarter Expansion", text: "Ongoing development around London Bridge including new office and residential towers.", source: "Various" },
            { lat: 51.5033, lng: -0.1195, category: "construction", title: "South Bank Regeneration", text: "Continued investment around South Bank cultural quarter.", source: "Lambeth Council" },
            { lat: 53.4835, lng: -2.2420, category: "construction", title: "Manchester St Johns Development", text: "Major mixed-use scheme near Manchester Arena.", source: "Allied London" },
            { lat: 52.4800, lng: -1.8900, category: "construction", title: "Birmingham Paradise Development", text: "Major city centre office and public realm scheme nearing completion.", source: "MEPC/Argent" },
            { lat: 53.4808, lng: -2.2426, category: "construction", title: "Manchester Co-op Live Arena", text: "UK's largest indoor arena now operational (23,500 capacity).", source: "Oak View Group" },
            { lat: 51.5500, lng: -0.1600, category: "construction", title: "HS2 Euston Rebuild", text: "Euston station redevelopment alongside HS2 terminus construction.", source: "HS2 Ltd" },
            { lat: 53.4084, lng: -2.9916, category: "construction", title: "Liverpool Waters", text: "150-acre, 30-year regeneration of Liverpool's northern docks.", source: "Peel Waters" },
            { lat: 51.5074, lng: 0.0400, category: "construction", title: "Royal Albert Dock Regeneration", text: "ABP investment in major Chinese business park.", source: "ABP" },
            { lat: 54.9720, lng: -1.6100, category: "construction", title: "Newcastle East Pilgrim Street", text: "Major office-led regeneration of Newcastle city centre.", source: "Pilgrim Street LLP" },
            { lat: 53.7997, lng: -1.5400, category: "construction", title: "Leeds South Bank", text: "Major regeneration south of River Aire including new homes and HS2 station site.", source: "Leeds City Council" },
            { lat: 52.4862, lng: -1.8904, category: "construction", title: "Birmingham Smithfield", text: "Redevelopment of former wholesale markets site in city centre.", source: "BCC/Lendlease" },
            { lat: 51.5100, lng: -0.1200, category: "construction", title: "Strand Aldwych Transformation", text: "Major public realm improvements completed creating new pedestrian space.", source: "Westminster Council" },
            { lat: 53.3811, lng: -1.4600, category: "construction", title: "Sheffield Heart of the City II", text: "City centre regeneration including new retail and office space.", source: "Sheffield City Council" },
            { lat: 51.4500, lng: -2.6200, category: "construction", title: "Bristol Arena Development", text: "New arena and conference facility at Temple Island.", source: "Bristol City Council" },
            { lat: 50.9097, lng: -1.4044, category: "construction", title: "Southampton Watermark WestQuay", text: "Mixed-use leisure development completion.", source: "Hammerson" },
            { lat: 54.5704, lng: -1.2350, category: "construction", title: "Middlesbrough Town Centre", text: "Town centre regeneration including new entertainment venues.", source: "Middlesbrough Council" },
            { lat: 55.9533, lng: -3.1883, category: "construction", title: "Edinburgh St James Quarter", text: "Major city centre retail and leisure scheme completed.", source: "Nuveen Real Estate" },
            { lat: 53.4084, lng: -2.9916, category: "construction", title: "Everton Stadium Bramley-Moore Dock", text: "New 52,888 capacity stadium under construction on Liverpool waterfront.", source: "Everton FC" },
            { lat: 51.5540, lng: 0.0240, category: "construction", title: "Olympic Park Queen Elizabeth", text: "Continued development of residential and cultural facilities at former Olympic site.", source: "LLDC" },
            { lat: 53.4720, lng: -2.2470, category: "construction", title: "Manchester Mayfield", text: "18-acre mixed-use development including new park in city centre.", source: "U+I/LCR/Manchester City Council" },

            // ADDITIONAL DEVOLUTION & GOVERNANCE
            { lat: 51.5074, lng: -0.1278, category: "devolution", title: "English Devolution Bill", text: "Government's framework for expanding devolution across England, enabling more areas to access powers.", source: "MHCLG" },
            { lat: 55.8642, lng: -4.2518, category: "devolution", title: "Glasgow City Region Deal", text: "City region deal delivering infrastructure and innovation investments across Glasgow region.", source: "Glasgow City Region" },
            { lat: 51.4816, lng: -3.1791, category: "devolution", title: "Cardiff Capital Region", text: "Cardiff Capital Region City Deal driving economic growth across South East Wales.", source: "CCR" },
            { lat: 53.0046, lng: -2.1798, category: "devolution", title: "Stoke-on-Trent Deal", text: "Discussions for Level 2 devolution deal covering Staffordshire and Stoke-on-Trent.", source: "DLUHC" },

            // ENERGY & NET ZERO PROJECTS
            { lat: 51.9200, lng: 1.4500, category: "construction", title: "Sizewell C Nuclear", text: "New nuclear power station approved - will provide 3.2GW of low-carbon electricity.", source: "EDF" },
            { lat: 51.2200, lng: 0.6300, category: "construction", title: "Lower Thames Crossing", text: "UK's largest road infrastructure project - 14.3 mile tunnel under Thames.", source: "National Highways" },
            { lat: 54.9100, lng: -1.3800, category: "local-growth", title: "North East Hydrogen Hub", text: "Major green hydrogen production facility planned for Teesside region.", source: "Various" },
            { lat: 53.4000, lng: 0.2000, category: "construction", title: "Hornsea Wind Farm", text: "World's largest offshore wind farm cluster - Hornsea 3 under construction.", source: "Orsted" },
            { lat: 55.1260, lng: -1.5080, category: "local-growth", title: "Blyth Offshore Wind Hub", text: "Major hub for offshore wind operations and maintenance.", source: "Port of Blyth" },
            { lat: 52.9400, lng: 1.1300, category: "construction", title: "Norwich Western Link", text: "New 3.9 mile road connecting A1270 to A47 under construction.", source: "Norfolk County Council" },
            { lat: 57.4800, lng: -4.2200, category: "local-growth", title: "Nigg Energy Park", text: "Major fabrication and construction facility for renewable energy.", source: "Global Energy Group" },

            // SCIENCE & RESEARCH
            { lat: 51.5700, lng: -1.3100, category: "local-growth", title: "Harwell Science Campus", text: "UK's largest science campus with 6,000+ people across 200+ organisations.", source: "UKRI" },
            { lat: 53.2300, lng: -2.2800, category: "local-growth", title: "Jodrell Bank Discovery Centre", text: "World heritage site and home to major radio astronomy research.", source: "UoM" },
            { lat: 51.0543, lng: -1.4400, category: "local-growth", title: "Porton Science Campus", text: "Major life sciences and bioscience research cluster.", source: "Porton Science" },
            { lat: 52.2053, lng: 0.1218, category: "local-growth", title: "Cambridge Biomedical Campus", text: "Europe's largest medical research campus with major hospital and research investment.", source: "CBC" },
            { lat: 50.7368, lng: -3.5339, category: "local-growth", title: "Exeter Science Park", text: "Growing science park linked to University of Exeter.", source: "Exeter Science Park" },
            { lat: 53.8700, lng: -1.6600, category: "local-growth", title: "Bradford Institute of Technology", text: "New Institute of Technology for advanced manufacturing and engineering.", source: "IoT" },
            { lat: 55.9221, lng: -3.1747, category: "local-growth", title: "Edinburgh BioQuarter", text: "Major life sciences cluster with research hospital and business space.", source: "Scottish Enterprise" }
        ];
        
        // Custom catapult icon
        const catapultIcon = L.divIcon({
            className: 'catapult-marker',
            html: '<div class="catapult-icon">üöÄ</div>',
            iconSize: [28, 28],
            iconAnchor: [14, 14]
        });
        
        // Add catapult markers
        catapultCentres.forEach(centre => {
            const marker = L.marker([centre.lat, centre.lng], {
                icon: catapultIcon
            }).addTo(catapultsLayer);
            
            marker.bindPopup(`
                <div class="popup-title">üöÄ ${centre.name}</div>
                <p><strong>Location:</strong> ${centre.location}</p>
                <p><strong>Type:</strong> ${centre.type}</p>
            `);
        });

        // Custom freeport icon
        const freeportIcon = L.divIcon({
            className: 'freeport-marker',
            html: '<div style="background: #00CED1; border: 2px solid #008B8B; border-radius: 4px; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 12px;">üö¢</div>',
            iconSize: [28, 28],
            iconAnchor: [14, 14]
        });

        // Add freeport markers
        freeports.forEach(freeport => {
            const marker = L.marker([freeport.lat, freeport.lng], {
                icon: freeportIcon
            }).addTo(freeportsLayer);

            marker.bindPopup(`
                <div class="popup-title">üö¢ ${freeport.name}</div>
                <p><strong>Location:</strong> ${freeport.location}</p>
                <p><strong>Status:</strong> <span style="color: ${freeport.status === 'Operational' ? 'green' : 'orange'};">${freeport.status}</span></p>
                <p><strong>Tax Sites:</strong> ${freeport.taxSites} | <strong>Customs Sites:</strong> ${freeport.customsSites}</p>
                <p><strong>Focus:</strong> ${freeport.focus}</p>
            `);
        });

        // Custom investment zone icon
        const investmentZoneIcon = L.divIcon({
            className: 'investment-zone-marker',
            html: '<div style="background: #FFD700; border: 2px solid #DAA520; border-radius: 4px; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 12px;">üí∞</div>',
            iconSize: [28, 28],
            iconAnchor: [14, 14]
        });

        // Add investment zone markers
        investmentZones.forEach(zone => {
            const marker = L.marker([zone.lat, zone.lng], {
                icon: investmentZoneIcon
            }).addTo(investmentZonesLayer);

            marker.bindPopup(`
                <div class="popup-title">üí∞ ${zone.name}</div>
                <p><strong>Region:</strong> ${zone.region}</p>
                <p><strong>Focus:</strong> ${zone.focus}</p>
                <p><strong>Funding:</strong> ¬£${zone.funding}</p>
            `);
        });

        // Category colors for intelligence
        const categoryColors = {
            'devolution': '#ff6b6b',
            'local-growth': '#4ecdc4',
            'transport': '#45b7d1',
            'construction': '#96c93d'
        };

        // Add pre-loaded intelligence markers
        preloadedIntelligence.forEach(intel => {
            const marker = L.circleMarker([intel.lat, intel.lng], {
                radius: 8,
                fillColor: categoryColors[intel.category],
                color: '#9932CC',
                weight: 3,
                fillOpacity: 0.8
            }).addTo(preloadedIntelLayer);

            const categoryLabel = intel.category.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase());

            marker.bindPopup(`
                <div class="popup-title">üì° ${intel.title}</div>
                <span class="popup-category ${intel.category}">${categoryLabel}</span>
                <div class="intel-item">${intel.text}</div>
                <p style="font-size: 10px; color: #666;">Source: ${intel.source}</p>
            `);
        });

        // Load intelligence from localStorage
        function loadIntelligence() {
            intelligenceLayer.clearLayers();
            const intel = JSON.parse(localStorage.getItem('ukDevolutionIntel') || '[]');
            
            const categoryColors = {
                'devolution': '#ff6b6b',
                'local-growth': '#4ecdc4',
                'transport': '#45b7d1',
                'construction': '#96c93d'
            };
            
            intel.forEach((item, index) => {
                const marker = L.circleMarker([item.lat, item.lng], {
                    radius: 10,
                    fillColor: categoryColors[item.category],
                    color: '#000',
                    weight: 2,
                    fillOpacity: 0.8
                }).addTo(intelligenceLayer);
                
                const categoryLabel = item.category.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase());
                
                marker.bindPopup(`
                    <div class="popup-title">üí° User Intelligence</div>
                    <span class="popup-category ${item.category}">${categoryLabel}</span>
                    <div class="intel-item">${item.text}</div>
                    <p style="font-size: 10px; color: #666;">Added: ${new Date(item.timestamp).toLocaleDateString()}</p>
                `);
            });
        }
        
        loadIntelligence();
        
        // Layer toggle controls
        document.getElementById('toggleAuthorities').addEventListener('change', function() {
            if (this.checked) {
                map.addLayer(authoritiesLayer);
            } else {
                map.removeLayer(authoritiesLayer);
            }
        });
        
        document.getElementById('toggleCatapults').addEventListener('change', function() {
            if (this.checked) {
                map.addLayer(catapultsLayer);
            } else {
                map.removeLayer(catapultsLayer);
            }
        });
        
        document.getElementById('toggleIntelligence').addEventListener('change', function() {
            if (this.checked) {
                map.addLayer(intelligenceLayer);
            } else {
                map.removeLayer(intelligenceLayer);
            }
        });

        document.getElementById('toggleFreeports').addEventListener('change', function() {
            if (this.checked) {
                map.addLayer(freeportsLayer);
            } else {
                map.removeLayer(freeportsLayer);
            }
        });

        document.getElementById('toggleInvestmentZones').addEventListener('change', function() {
            if (this.checked) {
                map.addLayer(investmentZonesLayer);
            } else {
                map.removeLayer(investmentZonesLayer);
            }
        });

        document.getElementById('togglePreloadedIntel').addEventListener('change', function() {
            if (this.checked) {
                map.addLayer(preloadedIntelLayer);
            } else {
                map.removeLayer(preloadedIntelLayer);
            }
        });
        
        // Location picking
        let pickingLocation = false;
        
        document.getElementById('pickLocationBtn').addEventListener('click', function() {
            pickingLocation = true;
            document.getElementById('clickInstruction').classList.add('active');
            map.getContainer().style.cursor = 'crosshair';
        });
        
        map.on('click', function(e) {
            if (pickingLocation) {
                document.getElementById('intelLat').value = e.latlng.lat.toFixed(6);
                document.getElementById('intelLng').value = e.latlng.lng.toFixed(6);
                document.getElementById('locationDisplay').value = `${e.latlng.lat.toFixed(4)}, ${e.latlng.lng.toFixed(4)}`;
                
                pickingLocation = false;
                document.getElementById('clickInstruction').classList.remove('active');
                map.getContainer().style.cursor = '';
            }
        });
        
        // Submit intelligence
        document.getElementById('submitIntel').addEventListener('click', function() {
            const lat = parseFloat(document.getElementById('intelLat').value);
            const lng = parseFloat(document.getElementById('intelLng').value);
            const category = document.getElementById('intelCategory').value;
            const text = document.getElementById('intelText').value.trim();
            
            const statusDiv = document.getElementById('statusMessage');
            
            if (!lat || !lng) {
                statusDiv.innerHTML = '<div class="status-message status-error">‚ö†Ô∏è Please pick a location on the map!</div>';
                return;
            }
            
            if (!text) {
                statusDiv.innerHTML = '<div class="status-message status-error">‚ö†Ô∏è Please enter some intelligence!</div>';
                return;
            }
            
            const intel = JSON.parse(localStorage.getItem('ukDevolutionIntel') || '[]');
            intel.push({
                lat,
                lng,
                category,
                text,
                timestamp: new Date().toISOString()
            });
            localStorage.setItem('ukDevolutionIntel', JSON.stringify(intel));
            
            // Clear form
            document.getElementById('intelLat').value = '';
            document.getElementById('intelLng').value = '';
            document.getElementById('locationDisplay').value = '';
            document.getElementById('intelText').value = '';
            
            // Reload markers
            loadIntelligence();
            
            statusDiv.innerHTML = '<div class="status-message status-success">‚ú® Intel added successfully! ‚ú®</div>';
            setTimeout(() => statusDiv.innerHTML = '', 3000);
        });
        
        // Clear all intelligence
        document.getElementById('clearAllIntel').addEventListener('click', function() {
            if (confirm('Are you sure you want to delete all your saved intelligence? This cannot be undone!')) {
                localStorage.removeItem('ukDevolutionIntel');
                loadIntelligence();
                document.getElementById('statusMessage').innerHTML = '<div class="status-message status-success">All intelligence cleared!</div>';
                setTimeout(() => document.getElementById('statusMessage').innerHTML = '', 3000);
            }
        });
        
        // Visitor counter (fake but fun)
        const baseCount = 42;
        const daysSinceEpoch = Math.floor(Date.now() / 86400000);
        const visitorCount = baseCount + (daysSinceEpoch % 1000);
        document.getElementById('visitorCount').textContent = visitorCount.toString().padStart(6, '0');
    </script>
</body>
</html>
